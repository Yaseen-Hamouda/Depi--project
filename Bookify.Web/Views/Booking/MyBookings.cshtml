@model IEnumerable<Bookify.Core.Models.Booking>

<h2 class="mb-4 text-primary"><i class="fas fa-calendar-alt me-2"></i>My Bookings</h2>

@if (!Model.Any())
{
    <div class="card border-info">
        <div class="card-body text-center py-5">
            <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No Bookings Yet</h4>
            <p class="text-muted">You haven't made any bookings yet.</p>
            <a href="@Url.Action("Index", "Rooms")" class="btn btn-primary mt-2">
                <i class="fas fa-search me-1"></i>Browse Rooms
            </a>
        </div>
    </div>
}
else
{
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="bg-light text-dark">
                        <tr>
                            <th class="py-3 px-4">
                                <i class="fas fa-door-closed me-2"></i>Room
                            </th>
                            <th class="py-3 px-4">
                                <i class="fas fa-sign-in-alt me-2"></i>Check In
                            </th>
                            <th class="py-3 px-4">
                                <i class="fas fa-sign-out-alt me-2"></i>Check Out
                            </th>
                            <th class="py-3 px-4">
                                <i class="fas fa-dollar-sign me-2"></i>Total Price
                            </th>
                            <th class="py-3 px-4">
                                <i class="fas fa-info-circle me-2"></i>Status
                            </th>
                            <th class="py-3 px-4 text-center">
                                <i class="fas fa-cogs me-2"></i>Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var booking in Model.OrderByDescending(b => b.CheckInDate))
                        {
                            <tr class="align-middle">
                                <td class="px-4 py-3">
                                    <div class="d-flex align-items-center">
                                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center"
                                             style="width: 40px; height: 40px;">
                                            <i class="fas fa-bed"></i>
                                        </div>
                                        <div class="ms-3">
                                            <strong>Room @booking.Room?.RoomNumber</strong>
                                            <small class="d-block text-muted">@booking.Room?.RoomType</small>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="fw-bold">@booking.CheckInDate.ToString("dd MMM yyyy")</div>
                                    <small class="text-muted">@booking.CheckInDate.DayOfWeek</small>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="fw-bold">@booking.CheckOutDate.ToString("dd MMM yyyy")</div>
                                    <small class="text-muted">@booking.CheckOutDate.DayOfWeek</small>
                                </td>
                                <td class="px-4 py-3 fw-bold text-success">
                                    $@booking.TotalPrice.ToString("N0")
                                </td>
                                <td class="px-4 py-3">
                                    @{
                                        string badgeClass = "";
                                        string iconClass = "";
                                        string statusText = booking.PaymentStatus?.ToString() ?? "Unknown";

                                        switch (statusText)
                                        {
                                            case "Paid":
                                                badgeClass = "badge bg-success";
                                                iconClass = "fas fa-check-circle";
                                                break;
                                            case "Pending":
                                                badgeClass = "badge bg-warning";
                                                iconClass = "fas fa-clock";
                                                break;
                                            case "Cancelled":
                                                badgeClass = "badge bg-danger";
                                                iconClass = "fas fa-times-circle";
                                                break;
                                            case "Confirmed":
                                                badgeClass = "badge bg-info";
                                                iconClass = "fas fa-check";
                                                break;
                                            case "Completed":
                                                badgeClass = "badge bg-secondary";
                                                iconClass = "fas fa-flag-checkered";
                                                break;
                                            default:
                                                badgeClass = "badge bg-secondary";
                                                iconClass = "fas fa-question-circle";
                                                break;
                                        }
                                    }
                                    <span class="@badgeClass p-2 rounded-pill d-inline-flex align-items-center">
                                        <i class="@iconClass me-1"></i>
                                        @statusText
                                    </span>
                                </td>
                                <td class="px-4 py-3 text-center">
                                    <div class="btn-group" role="group">
                                        <a href="@Url.Action("Details", "Booking", new { id = booking.Id })"
                                           class="btn btn-sm btn-outline-primary"
                                           title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        @if (statusText == "Pending")
                                        {
                                            <a href="@Url.Action("Edit", "Booking", new { id = booking.Id })"
                                               class="btn btn-sm btn-outline-warning"
                                               title="Edit Booking">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                        }
                                        @if (booking.CheckInDate > DateTime.Now)
                                        {
                                            <a href="@Url.Action("Cancel", "Booking", new { id = booking.Id })"
                                               class="btn btn-sm btn-outline-danger"
                                               title="Cancel Booking"
                                               onclick="return confirm('Are you sure you want to cancel this booking?')">
                                                <i class="fas fa-times"></i>
                                            </a>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Summary Card -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h6 class="card-title">Total Bookings</h6>
                    <h3 class="mb-0">@Model.Count()</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h6 class="card-title">Paid</h6>
                    <h3 class="mb-0">@Model.Count(b => b.PaymentStatus?.ToString() == "Paid")</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h6 class="card-title">Upcoming</h6>
                    <h3 class="mb-0">@Model.Count(b => b.CheckInDate > DateTime.Now)</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <h6 class="card-title">Pending</h6>
                    <h3 class="mb-0">@Model.Count(b => b.PaymentStatus?.ToString() == "Pending")</h3>
                </div>
            </div>
        </div>
    </div>
}